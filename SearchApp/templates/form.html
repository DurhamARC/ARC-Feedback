{% extends "base.html" %}
{% block title %}Additional Form{% endblock %}
{% block content %}

<div class="page-container">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="error-message" aria-live="polite">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    <form action="/thankyou" method="post" class="selection-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="card">
            <div class="card-content">
                <div class="field orcid-field">
                    <span><label for="feedback" class="form-label">Additional Message<p></p></label></span>
                    <textarea name="feedback" id="feedback" class="form-input" rows="5" placeholder="Please share your thoughts or feedback here..."></textarea>
                    <p id="char-counter">300 characters left</p>
                </div>
                <button type="submit" name="action" value="submit" class="btn btn-primary">
                    <span class="btn-text">Submit</span>
                </button>
            </div>
        </div>
    </form>
</div>

<style>
    :root {
        --primary-color: #68246D;
        --primary-hover: #99599f;
        --secondary-color: #a6ce39;
        --text-color: #333;
        --text-light: #636363;
        --error-bg: #ffe6e6;
        --error-text: #cc0000;
        --card-shadow: 0 4px 20px rgba(104, 36, 109, 0.08);
        --card-shadow-hover: 0 8px 25px rgba(104, 36, 109, 0.12);
        --input-focus: 0 0 8px rgb(190, 190, 190);
        --transition: all 0.3s ease;
        --gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, #8a3a8f 100%);
        --gradient-secondary: linear-gradient(135deg, var(--secondary-color) 0%, #c1e05a 100%);
        --body-bg: #f9f6fa;
        --card-bg: white;
        --navbar-bg: white;
        --selection-bg: #68246D;
        --selection-text: #f8f8f8;
        --button-text: white;
        --form-input: #333;
        --hovering: #5f3863;
    }

    body.dark-mode {
        --primary-color: #9d5ba2;
        --primary-hover: #b46bb9;
        --body-bg: #252525;
        --card-bg: #353535;
        --navbar-bg: #353535;
        --text-color: #e8e8e8;
        --text-light: #b8b8b8;
        --selection-bg: #9d5ba2;
        --selection-text: #ffffff;
        --button-text: #ffffff;
        --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.4);
        --input-focus: 0 0 8px rgba(157, 91, 162, 0.4);
        --gradient-primary: linear-gradient(135deg, #9d5ba2 0%, #7a4580 100%);
        --gradient-secondary: linear-gradient(135deg, #a6ce39 0%, #8bb82e 100%);
        --error-bg: #3d1f1f;
        --error-text: #ffb3b3;
        --form-input: rgb(200, 200, 200);
        --hovering: #b46bb9;
    }

    .char-counter {
        -webkit-text-fill-color: var(--text-color);
    }

    .card-content {
        zoom: 80%;
    }

    .form-label {
        margin:auto;
        margin-top: 0.65rem;
        color: var(--text-color);
        font-size: 1.25rem;
    }

    .form-input {
        color: var(--form-input);
        font-style: normal;
        text-align: left;
    }

    textarea.form-input {
        font-size: 19px;
        width: 100%;
        height: 150px;
        min-width: 200px;
        max-width: 100%;
        min-height: 200px;
        max-height: 333px; 
        resize: vertical;
    }

    .btn {
        padding: 1rem 2.5rem;
        border: none;
        border-radius: 9999px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color) 0%, #8a3a8f 100%);
        color: white !important;
        box-shadow: 0 4px 15px rgba(104, 36, 109, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, var(--hovering) 0%, #792b7c 100%);
    }

</style>

<script>
    document.getElementById('orcidInput')?.addEventListener('input', function(e) {
        this.value = this.value.toUpperCase();
    });

    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('feedback');
        const counter = document.getElementById('char-counter');
        
        function handleInput() {
            const text = textarea.value;
            const length = text.length;
            if (length > 300) {
                textarea.value = text.substring(0, 300);
            }
            const remaining = 300 - textarea.value.length;
            counter.textContent = `${remaining} characters left`;
            if (remaining <= 0) {
                counter.style.color = 'red';
            } else {
                counter.style.color = '';
            }
        }
        
        textarea.addEventListener('input', handleInput);
        handleInput();
    });
</script>
{% endblock %}